apiVersion: postgresql.cnpg.io/v1
kind: Cluster
metadata:
  name: pg-ai
  labels:
    app.kubernetes.io/name: pg-ai
    app.kubernetes.io/part-of: postgres
spec:
  description: "Shared PostgreSQL cluster for AI workloads."

  imageName: ghcr.io/cloudnative-pg/postgresql:18.1
  instances: 3
  primaryUpdateStrategy: unsupervised

  storage:
    storageClass: ceph-block
    size: 50Gi
  walStorage:
    storageClass: ceph-block
    size: 10Gi

  enableSuperuserAccess: true

  postgresql:
    parameters:
      max_connections: "200"
      log_min_duration_statement: "500ms"
    synchronous:
      method: any
      number: 1
      dataDurability: preferred
